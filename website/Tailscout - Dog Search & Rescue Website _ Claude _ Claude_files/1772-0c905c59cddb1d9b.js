"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1772],{2341:(e,t,n)=>{n.d(t,{B:()=>u,N:()=>l});var a=n(54568),r=n(7620);let i=(0,r.createContext)(null),u=()=>{let e=(0,r.useContext)(i);return void 0===e?null:e},l=e=>{let{children:t,settings:n}=e;return(0,a.jsx)(i.Provider,{value:n,children:t})}},7726:(e,t,n)=>{n.d(t,{sk:()=>C,dy:()=>E,Rs:()=>B,Fn:()=>L,CW:()=>Q,bT:()=>x,t7:()=>P,Vt:()=>O,uE:()=>b,OZ:()=>M,$z:()=>m,O2:()=>D,mz:()=>S,FG:()=>K,Bq:()=>w,EV:()=>T,Lo:()=>q,_W:()=>U,yu:()=>R,HA:()=>j,HF:()=>V,Pt:()=>N,HI:()=>Y,Du:()=>k,wR:()=>X,aC:()=>A,gG:()=>z,lj:()=>F});var a=n(98518),r=n(77186),i=n(1761),u=n(2341),l=n(53248),o=n(71473),s=n(7620);function d(e){let t=JSON.stringify(e);return(0,s.useMemo)(()=>e,[t])}var c=n(75632),y=n(70825),v=n(87606),g=n(7703),_=n(92012),p=n.n(_),h=n(62942),f=n(57067);let m=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,[r,u]=(0,s.useReducer)(e=>e+1,0),l=d([o.fC,{orgUUID:a},{uuid:e}]),c=(0,s.useMemo)(()=>t.getQueryData(l),[t,l,e,r]);return(0,s.useEffect)(()=>t.getQueryCache().subscribe(e=>{"updated"===e.type&&"success"===e.action.type&&(0,g.MK)({queryKey:l},e.query)&&u()}),[t,u,l]),{data:c}},S=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,r=d([o.fC,{orgUUID:a},{uuid:e}]);return t.getQueryData(r)},C=30,E=1e4,T=e=>{let{limit:t,offset:n,enabled:a=!0,starred:u}=e,{activeOrganization:l}=(0,i.YL)(),s=null==l?void 0:l.uuid,d=new URLSearchParams;void 0!==t&&d.append("limit",t.toString()),void 0!==n&&d.append("offset",n.toString()),void 0!==u&&d.append("starred",u.toString());let c=d.toString();return c=c?"?".concat(c):"",(0,r.Sk)("/api/organizations/".concat(null!=s?s:"","/chat_conversations").concat(c),{queryKey:[o.DC,{orgUUID:s},{limit:t,offset:n,starred:u}],staleTime:3e5,enabled:!!s&&a})},L=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/chat_conversations/count_all"),{queryKey:[o.Ad,{orgUUID:t}],staleTime:3e5,enabled:!!t})},b=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,r.mn)();return(0,s.useCallback)(async n=>{let{limit:a,offset:r}=n,i=new URLSearchParams;void 0!==a&&i.append("limit",a.toString()),void 0!==r&&i.append("offset",r.toString());let u=i.toString();return u=u?"?".concat(u):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(u))).json()},[null==e?void 0:e.uuid,t])},w=function(e){let{suppressError:t,enabled:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enabled:!0},{activeOrganization:a}=(0,i.YL)(),u=null==a?void 0:a.uuid,l=(0,s.useRef)([]),d=(0,v.useQueryClient)(),c="/api/organizations/".concat(null!=u?u:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),y=(0,r.Sk)(c,{queryKey:[o.fC,{orgUUID:u},{uuid:e}],staleTime:3e5,enabled:!!u&&!!e&&n,meta:{noToast:t}},t=>(d.invalidateQueries({queryKey:[o.XF,{orgUUID:u,conversationUUID:e}]}),(0,f.H6)(t))),g=(0,s.useMemo)(()=>{if(!y.data)return l.current=[],l.current;let e=(0,f.$)(y.data);if(e.length!==l.current.length||e.some((e,t)=>{var n;return e.uuid!==(null==(n=l.current[t])?void 0:n.uuid)}))return l.current=e,l.current;for(let t=0;t<e.length;t++)p()(e[t],l.current[t])||(l.current[t]=e[t]);return l.current},[y.data]);return{...y,currentPath:g}},U=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid;return(0,s.useCallback)(()=>{t.invalidateQueries({queryKey:[o.fC,{orgUUID:a},{uuid:e}]})},[t,a,e])},x=(e,t)=>{let{mutateAsync:n}=Q(),a=(0,h.useRouter)(),r=t||(0,c.N)();return(0,s.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},i={uuid:r,name:"",model:t.model};t.createMode&&(i.create_mode=t.createMode),t.projectUuid&&(i.project_uuid=t.projectUuid),n(i).then(()=>{let n="/chat/".concat(r).concat(t.controlsOpen?"?controls=1":"");a[e](n)}).catch(e=>{(0,y.Cp)(e)})},[n,a,e,r])},Q=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,v.useQueryClient)(),a=e=>[o.fC,{orgUUID:t},{uuid:e}];return(0,r.L2)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,onSuccess:e=>{n.setQueryData(a(e.uuid),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map}))}})},P=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,v.useQueryClient)();return(0,r.Qv)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let a=t.findIndex(e=>e.uuid===n);if(!(a>-1))return t;{let e=[...t];return e.splice(a,1),e}},{enabled:!!t,queryKey:[o.DC,{orgUUID:t}],onSuccess:async(e,a)=>{let{uuid:r,projectUuid:i}=a;await n.invalidateQueries({queryKey:[o.fC,{orgUUID:t},{uuid:r}]}),i&&await n.invalidateQueries({queryKey:[o.yF,{orgUuid:t,projectUuid:i}]}),await H(n,t)}})},O=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,v.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await H(a,n),e&&e(t)}})},R=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/shares"),{queryKey:[o._J,{orgUUID:t}],enabled:!!t,staleTime:3e5})},D=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e,queryKey:[o.XF,{orgUUID:n,conversationUUID:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:a}=e;return{shareable:n,disabled_reason:a,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,f.XU)(e))}:null}})},K=e=>{let{activeOrganization:t,account:n}=(0,i.YL)(),a=null==t?void 0:t.uuid,u=n&&a?"/api/organizations/".concat(a,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,r.Sk)(u,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[o.Bn,{orgUUID:a,snapshotUUID:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,f.XU)(e))}))},k=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,v.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{a.invalidateQueries({queryKey:[o.XF,{orgUUID:n,conversationUUID:e}]}),a.invalidateQueries({queryKey:[o._J,{orgUUID:n}]}),a.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]})}})},z=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,u=(0,v.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(a,"/share/").concat(t),"DELETE",{enabled:!!a&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{u.invalidateQueries({queryKey:[o.XF,{orgUUID:a,conversationUUID:e}]}),u.invalidateQueries({queryKey:[o._J,{orgUUID:a}]}),u.invalidateQueries({queryKey:[o.A2,{orgUUID:a}]})}})},q=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e&&!!n,staleTime:0,queryKey:[o.Fz,{artifactVersionUUID:e}]})},j=function(e,t,n){var l,s,d;let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:y}=(0,a.st)(),g=null!=(s=null==(l=(0,u.B)())?void 0:l.preview_feature_uses_artifacts)&&s,{activeOrganization:_}=(0,i.YL)(),p=null==_?void 0:_.uuid,h=(0,v.useQueryClient)(),f=[o.fC,{orgUUID:p},{uuid:e}];return(0,r.L2)("/api/organizations/".concat(null!=p?p:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!=(d=t.uuid)?d:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!p,meta:{errorMessage:"We could not save your feedback. Please try again later."},...c,onSuccess(){for(var a,r,i=arguments.length,u=Array(i),l=0;l<i;l++)u[l]=arguments[l];y({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:g,conversationHasArtifacts:n,type:null==(a=t.chat_feedback)?void 0:a.type}),h.invalidateQueries({queryKey:f}),null==(r=c.onSuccess)||r.call(c,...u)}})},I=()=>{let e=(0,v.useQueryClient)(),{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,s.useCallback)((t,a)=>{t&&(e.setQueryData([o.fC,{orgUUID:n},{uuid:t}],e=>e&&{...e,...a}),e.setQueriesData({queryKey:[o.DC,{orgUUID:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...a})))},[n,e])},Y=e=>{let t=(0,v.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,u=I();return(0,r.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var r;let{name:i}=n,l=t.getQueryData([o.fC,{orgUUID:a},{uuid:e}]);return u(e,{name:i}),{oldTitle:null!=(r=null==l?void 0:l.name)?r:""}},onError(t,n,a){a&&u(e,{name:a.oldTitle})}})},M=e=>{let t=I(),{activeOrganization:n}=(0,i.YL)();return(0,r.L2)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:a}=n;t(e,{name:null!=a?a:""})},meta:{noToast:!0}})};function B(e){var t,n;let a=(0,l.C)(e),r=e.attachments.map(e=>e.extracted_content).join(" ");return a+" "+r+" "+((null==(t=e.content)?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null==(n=e.content)?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let A=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},N=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},F=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},V=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=(0,v.useQueryClient)(),u=null==n?void 0:n.uuid;return(0,r.Qv)("/api/organizations/".concat(u,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{H(a,u)},onSettled:()=>{(null==t?void 0:t.refetchOnSettled)&&a.refetchQueries({queryKey:[o.fC,{orgUUID:u},{uuid:e}]})},queryKey:[o.fC,{orgUUID:u},{uuid:e}]})},H=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:[o.DC,{orgUUID:t}]}),e.invalidateQueries({queryKey:[o.Ad,{orgUUID:t}]})])},X=e=>{let{activeOrganization:t}=(0,i.YL)(),n=(0,v.useQueryClient)(),a=null==t?void 0:t.uuid;return(0,r.Qv)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{H(n,a)},queryKey:[o.fC,{orgUUID:a},{uuid:e}]})}},29242:(e,t,n)=>{n.d(t,{m:()=>v});var a=n(42977),r=n(54568),i=n(90510),u=n(32987),l=n(37463),o=n(67754);function s(){let e=(0,a._)(["\n  px-2\n  py-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-md\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return s=function(){return e},e}function d(){let e=(0,a._)(["\n  max-w-[337px]\n  z-tooltip\n  [*:disabled_&]:hidden\n"]);return d=function(){return e},e}function c(){let e=(0,a._)(["\n  p-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-lg\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return c=function(){return e},e}function y(){let e=(0,a._)(["\n  p-1\n  text-sm\n  font-normal\n  font-styrene\n  leading-tight\n  border-border-300\n  border-0.5\n  rounded-lg\n  shadow-diffused \n  shadow-[hsl(var(--always-black)/4%)]\n  text-text-100\n  bg-bg-100\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return y=function(){return e},e}function v(e){let{children:t,tooltipContent:n,contentStyle:a="default",side:i="top",sideOffset:l,align:s,className:d,delayDuration:c=200,...y}=e,v=p[a];return(0,r.jsx)(o.Kq,{delayDuration:c,children:(0,r.jsxs)(o.bL,{...y,children:[(0,r.jsx)(o.l9,{asChild:!0,children:t}),(0,r.jsx)(o.ZL,{children:(0,r.jsx)("span",{children:(0,r.jsx)(v,{className:(0,u.A)(d,!n&&"hidden"),sideOffset:null!=l?l:5,side:i,align:s,children:n})})})]})})}let g=(0,i.J)(o.UC)(s()),_=(0,i.J)(o.UC)(d()),p={default:g,citation:e=>{let{children:t,...n}=e;return(0,r.jsx)(_,{...n,children:(0,r.jsx)(l.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},className:"p-1 text-sm font-normal font-styrene leading-tight text-text-200 bg-bg-100 break-words border-0.5 border-border-300/25 max-h-[300px] shadow-diffused shadow-[hsl(var(--always-black)/4%)] rounded-lg overflow-y-auto",children:t})})},inputMenu:(0,i.J)(o.UC)(c()),sampleImage:(0,i.J)(o.UC)(y())}},53248:(e,t,n)=>{n.d(t,{C:()=>a});let a=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},55554:(e,t,n)=>{n.d(t,{TierSelectorProvider:()=>c,t:()=>d});var a=n(54568),r=n(46612),i=n(27062),u=n(85544),l=n(7620),o=n(96712);let s=(0,l.createContext)(null),d=()=>{let e=(0,l.useContext)(s);if(!e)throw Error("useTierSelector must be used within a TierSelectorProvider");return e},c=e=>{var t;let{children:n,initialEnabled:d=!1}=e,c=(0,o.l)(),[y,v]=(0,l.useState)(()=>c.get(r.eT.SELECTED_TIER)||null),[g,_]=(0,l.useState)(()=>"true"===c.get(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS)),[p,h]=(0,l.useState)(()=>"true"===c.get(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS)),f=null!=(t=(0,i.fS)("internal_tier_selector").value)?t:d,m=(0,l.useState)(f)[1],S=(0,l.useCallback)(()=>{let e=[u.d7.FREE,u.d7.PRO,u.d7.ENTERPRISE,u.d7.MAX],t=Math.floor(Math.random()*e.length);return e[t]},[]),C=(0,l.useCallback)(e=>{if(!f)return void v(e);if(null===e){let e=y||S();c.set(r.eT.SELECTED_TIER,e,{maxAgeSeconds:2592e3})}else c.set(r.eT.SELECTED_TIER,e);v(e)},[y,v,c,S,f]);(0,l.useEffect)(()=>{f?y&&c.set(r.eT.SELECTED_TIER,y):c.delete(r.eT.SELECTED_TIER)},[f,y,c]);let E=(0,l.useCallback)(e=>{if(!f)return void _(e);e?c.set(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS,"true"):c.delete(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),_(e)},[f,c]),T=(0,l.useCallback)(e=>{if(!f)return void h(e);e?c.set(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS,"true"):c.delete(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS),h(e)},[f,c]);return(0,l.useEffect)(()=>{f||(c.delete(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),c.delete(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS))},[f,c]),(0,a.jsx)(s.Provider,{value:{selectedTier:y,isTierSelectorEnabled:f,setSelectedTier:C,setIsTierSelectorEnabled:m,shouldOverrideTokenLimits:g,setShouldOverrideTokenLimits:E,shouldOverrideFeatureAccess:p,setShouldOverrideFeatureAccess:T},children:n})}},57067:(e,t,n)=>{n.d(t,{$:()=>h,AP:()=>c,GN:()=>s,Gp:()=>d,H6:()=>g,Rh:()=>l,XU:()=>y,ZQ:()=>_,gF:()=>o,gX:()=>f,gv:()=>u,xQ:()=>p});var a=n(70825),r=n(6363),i=n.n(r);let u="new-assistant-message-uuid",l="new-human-message-uuid",o="00000000-0000-4000-8000-000000000000",s=e=>e!==u;function d(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,a.Cp)(e),e}return n}let c=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;for(;n!==o;){var a;let t=d(e.parentByChildUuid,n),r=null==(a=d(e.childrenByParentUuid,t))?void 0:a.indexOf(n);e.selectedChildByUuid.set(t,r),n=t}return{...e,current_leaf_message_uuid:t}},y=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},v=e=>{var t,n,a;let r=new Map,i=new Map,u=new Map,l=new Map,s=new Map;if(0===e.chat_messages.length)return{messageByUuid:i,parentByChildUuid:u,childrenByParentUuid:l,selectedChildByUuid:s};let d=e.chat_messages.map(y);for(let e of d)r.set(e.index,e),i.set(e.uuid,e);for(let e of d){let t=e.parent_message_uuid;if(!t){let a=e.index-1;for(;!t&&a>=0;)t=null==(n=r.get(a))?void 0:n.uuid,a--}t=null!=t?t:o,u.set(e.uuid,t),l.set(t,(null!=(a=l.get(t))?a:[]).concat(e.uuid)),s.set(t,0)}if(!(null==(t=l.get(o))?void 0:t[0]))throw Error("No root message found");return{chat_messages:d,messageByUuid:i,parentByChildUuid:u,childrenByParentUuid:l,selectedChildByUuid:s}},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let a=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),r={...e,chat_messages:a},i={...r,...v(r)};return i.current_leaf_message_uuid||c(i),c(i,r.current_leaf_message_uuid)},_=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},p=(e,t)=>{for(let a of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!a.parent_message_uuid)throw Error("Parent UUID required");let t=a.parent_message_uuid;e.messageByUuid.set(a.uuid,a),e.parentByChildUuid.set(a.uuid,t);let r=null!=(n=e.childrenByParentUuid.get(t))?n:[];r.push(a.uuid),e.childrenByParentUuid.set(t,r),e.selectedChildByUuid.set(t,r.length-1)}return c(e,t[t.length-1].uuid)},h=(e,t)=>{let n=[],a=null!=t?t:o;for(;e.childrenByParentUuid.has(a);){let t=d(e.childrenByParentUuid,a);if(0===t.length)break;let r=d(e.selectedChildByUuid,a),i=d(e.messageByUuid,t[r]);n.push({...i,parent_message_uuid:a,nOptions:t.length,selectedOption:r}),a=i.uuid}return n};function f(e,t,n){var a;let r=d(e.parentByChildUuid,t.uuid),u=d(e.childrenByParentUuid,r),l=i()((null!=(a=t.selectedOption)?a:0)+n,0,u.length-1);e.selectedChildByUuid.set(r,l);let o=h(e,r);return c(e,o[o.length-1].uuid)}},75632:(e,t,n)=>{n.d(t,{N:()=>a});let a=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()},80731:(e,t,n)=>{n.d(t,{K:()=>l,p:()=>o});var a=n(1761),r=n(55554),i=n(85544),u=n(21036);let l=()=>{let e=(0,a.O9)(),t=(0,a.zc)(),n=(0,a.mV)(),{selectedTier:l,shouldOverrideFeatureAccess:o,isTierSelectorEnabled:s}=(0,r.t)(),d=(0,u.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0,c=s&&o&&l?l===i.d7.PRO||l===i.d7.MAX||l===i.d7.ENTERPRISE:e||t||n;return d||c},o=()=>{let e=(0,a.O9)(),t=(0,a.zc)(),n=(0,a.mV)(),{selectedTier:l,shouldOverrideFeatureAccess:o,isTierSelectorEnabled:s}=(0,r.t)(),d=(0,u.useDynamicConfig)("claude_ai_projects_limits");if(!(s&&o&&l?l===i.d7.PRO||l===i.d7.MAX||l===i.d7.ENTERPRISE:e||t||n))return d.get("max_free_projects",0)}},81527:(e,t,n)=>{n.d(t,{BN:()=>x,CB:()=>m,Gz:()=>Q,Kf:()=>S,LQ:()=>U,PL:()=>f,bL:()=>L,bs:()=>E,dx:()=>_,eW:()=>w,fo:()=>T,gM:()=>p,gr:()=>h,sC:()=>g,sS:()=>b});var a=n(7726),r=n(77186),i=n(1761),u=n(29585),l=n(71473),o=n(27062),s=n(87606),d=n(37457),c=n.n(d),y=n(7620),v=n(80731);let g=30,_=1e4;var p=function(e){return e.Student="student",e}({}),h=function(e){return e.Study="study",e.Career="career",e.Research="research",e}({});let f=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[l.Wy,{orgUUID:t}],staleTime:3e5,enabled:!!t})},m=e=>{let{enabled:t=!0,limit:n,offset:a,starred:u,creatorFilter:s}=e,{activeOrganization:d}=(0,i.YL)(),c=(0,v.K)(),y=(0,o.fS)("show-archived-projects"),g=null==d?void 0:d.uuid,_=new URLSearchParams;return _.append("include_harmony_projects","true"),void 0!==n&&_.append("limit",n.toString()),void 0!==a&&_.append("offset",a.toString()),void 0!==u&&_.append("starred",u.toString()),void 0!==s&&_.append("creator_filter",s.toString()),(0,r.Sk)("/api/organizations/".concat(g,"/projects?").concat(_.toString()),{queryKey:[l.BP,{orgUuid:g},{limit:n,offset:a,starred:u,creatorFilter:s}],enabled:!!(t&&d&&c),select:e=>{let t=e.length===n;return Object.assign(y?e:e.filter(e=>!e.archived_at),{hasMore:t})}})},S=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,r.mn)();return(0,y.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},C=(e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),a=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...a]},E=()=>{let e=S(),t=(0,a.uE)();return(0,y.useCallback)(async()=>{let[n,r]=await Promise.all([e(),t({limit:a.dy})]);return C(n,r)},[t,e])},T=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[l.hc,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof u.LG&&404===e.statusCode}})},L=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,s.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[l.BP,{orgUuid:t}]})}})},b=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=Q();return(0,r.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{a(e)},queryKey:[l.hc,{orgUuid:n,projectUuid:e}]})},w=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=Q();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"DELETE",{onSuccess:()=>{a(e)}})},U=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/projects/").concat(e,"/conversations"),{queryKey:[l.yF,{orgUuid:n,projectUuid:e}],enabled:!!t,staleTime:0,select:e=>c()(e,e=>new Date(e.updated_at)).reverse()})},x=()=>{var e,t;let n=m({enabled:!0,creatorFilter:"is_creator",limit:_}),a=null==(t=n.data)||null==(e=t.find(e=>e.is_starter_project))?void 0:e.uuid;return{...n,data:a}},Q=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,s.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[l.hc,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[l.BP,{orgUuid:t}]}),n.invalidateQueries({queryKey:[l.yF,{orgUuid:t,projectUuid:e}]})}}}}]);